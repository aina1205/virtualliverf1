<%
    queue = AuthLookupUpdateQueue.all | ReindexingQueue.all
    queue = queue.sort_by &:created_at
    delayed_jobs = Delayed::Job.all(:order=>:created_at)
%>


<p>
  Total delayed jobs waiting = <%= delayed_jobs.count -%>
</p>
<table>
    <tr>
		<th>Handler</th>
        <th>Time created</th>
        <th>Priority</th>
		<th>Run at</th>
        <th>Locked at</th>
        <th>Failed at</th>
   </tr>
  <% delayed_jobs.each do |item| %>
    <tr>
      <td><%= item.handler -%></td>
      <td><%= date_as_string(item.created_at,true) -%></td>
      <td><%= item.priority -%></td>
      <td><%= date_as_string(item.run_at,true) -%></td>
      <td><%= date_as_string(item.locked_at,true) -%></td>
      <td><%= date_as_string(item.failed_at,true) -%></td>
    </tr>
   <% end -%>
</table>

<hr/>

<p>
  Total waiting in queues = <%= queue.count -%>
</p>
<table id="job_queue">
   <tr>
        <th>Type</th>
		<th>Time created</th>
		<th>Item type</th>
		<th>Item id</th>
   </tr>
   <% queue.each do |item| %>
    <tr>
      <td><%= item.class.name -%></td>
      <td><%= date_as_string(item.created_at,true) -%></td>
      <td><%= item.item_type -%></td>
      <td><%= item.item_id -%></td>
    </tr>
   <% end -%>
</table>