<% current_user_authorized_to_manage = Authorization.is_authorized?("manage", nil, @data_file, current_user) -%>
<%= javascript_include_tag 'assays.js' %>
<%= stylesheet_link_tag 'anytime' %>
<%= javascript_include_tag 'jquery-1.4.2.min.js' %>
<%= javascript_include_tag 'anytime.js' %>

<h1><%= @new ? 'New Event' : ('Editing Event: ' + link_to(h(@event.title), event_path(@event))) -%></h1>
<div class="show_basic">
  <% form_for @event do |f| %>
    <div class="asset_form">
      <%= f.error_messages %>

      <h2>Event Information</h2>
      <div style="text-align: center;">
        <div style="width: 95%;">
          <p>
            <%= f.label :title -%>
            <%= f.text_field :title, :style => "width: 100%;",:rows=>2 -%>
          </p>
          <p>
            <%= f.label :description %><br/>
            <%= f.text_area :description, :style => "width:100%", :rows => 10 %>
          </p>
          <p>
            <%= f.label :start_date %>
            <%= f.text_field :start_date, :style => "width: 100%" %>
            <input type="button" id="event_start_date_clear" value="clear" />
            <script type="text/javascript">
              AnyTime.picker( "event_start_date",
              { format: "%Y-%d-%m %T" } );
              $("#event_start_date_clear").click( function(e) {
              $("#event_start_date").val("").change(); } );
            </script>
  <%#= datetime_select "event", "start_date"%>
          </p>
          <p>
            <%= f.label :end_date %>
            <%= f.text_field :end_date, :style => "width: 100%" %>
            <input type="button" id="event_end_date_clear" value="clear" />
            <script type="text/javascript">
              AnyTime.picker( "event_end_date",
              { format: "%Y-%d-%m %T" } );
              $("#event_end_date_clear").click( function(e) {
              $("#event_end_date").val("").change(); } );
            </script>

  <%#= datetime_select "event", "end_date"%>
          </p>
          <p>
            <%= f.label "Event Website" -%><br/>
            <%= f.text_field :url, :style => "width:100%" -%>
          </p>
          <p style="margin-top: 1.5em;">
            <%= f.label :address -%><br/>
            <%= f.text_area :address, :style => "width: 100%;", :rows => 4 -%>
          </p>
          <p>
            <%= f.label :city -%><br/>
            <%= f.text_field :city, :style => "width: 100%;" -%>
          </p>

          <p>
            <%= f.label :country -%><br/>
            <%= f.country_select :country, nil, {}, :style => "width: 100%;" -%>
          </p>

          <% if current_user_authorized_to_manage -%>
            <%= render :partial => "assets/project_selector", :locals => { :resource_type => "Event",  # this is only for presentation, not for any processing
              :selected_project_id => @event.project_id,
              :project_hash => current_user.generate_own_project_id_name_hash,
              :allow_nil => true} -%>
          <% end -%>

          <%= render :partial => "assets/associate_data_file",:locals=>{:f=>f, :resource => @event,:show_relationships=>false} -%>
          <% if current_user_authorized_to_manage -%>
            <p>
              <%= render :partial => "assets/sharing_form" -%>
            </p>
          <%  end %>
        </div>
      </div>
    </div>
    <p>
      <%= f.submit(@new ? "Create" : "Update",:disable_with=>(@new ? "Creating...":"Updating...")) %>
    </p>
  <% end %>
</div>
