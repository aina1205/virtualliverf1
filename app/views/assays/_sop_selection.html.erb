


<div class="yui-g">
  <div class="yui-u first">
    <p style="color: #666666;">
      The following Sops are involved in this assay:
    </p>
    <p id="sop_to_list" class="box_editing_inner" style="line-height: 1.5;">
      <span class="none_text" id="sops">Loading...</span>
    </p>
    <br/>
    <%= label_tag :sops %><br/>
    <%= f.collection_select :sop_ids,[],:id,:title,{},:multiple=>true,:style=>"display:none;" %>

    <%= select_tag :possible_sops,
      options_for_select([["Select Sop ...",0]]|authorised_sops_for_user.collect{|s| [truncate(h(s.title),:length=>32),s.id]}),
      {:onchange=>remote_function(
        :url=>{:action=>"sop_preview_ajax",:controller=>"sops"},
        :with=>"'id='+this.value",
        :before=>"show_ajax_loader('sop_preview')"
      )
    } -%>
    <b><%= link_to_function "Add","addSelectedSop(); return(false);" %></b>
  </div>

  <div id="sop_preview" class="yui-u">
    <center>SOP preview</center>
  </div>

</div>

<script type="text/javascript">
<% @assay.sops.each do |s| -%>
    sop_id = <%= s.id -%>;
    sop_title = '<%= s.title -%>';
    addSop(sop_title,sop_id);
<% end -%>

  updateSops();
</script>









