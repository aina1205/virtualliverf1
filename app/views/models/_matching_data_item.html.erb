
<%
    data_file = DataFile.find(matching_data_item.primary_key)
    plots = data_file.latest_version.spreadsheet_annotations.select{|a| a.attribute.name=="plot_data"}
%>

<li class="matching_data_item">
  <div class="title">
    <%= list_item_title data_file -%>
    <span class="score">
     - matched by <b><%= matching_data_item.search_terms.join(", ") -%></b>
    </span>
    <span class="score">
        ( <%= matching_data_item.score -%> )
    </span>
  </div>
  <%= list_item_contributor data_file -%>
  <%= list_item_tag_list data_file -%>
  <div class="box_standout description">
      <%= text_or_not_specified(data_file.description, :description=>true, :length=>500) -%>
  </div>

  <div>
    <ul class="plots">
      <% plots.each do |plot| -%>
          <%
             div_id = "plot_#{UUIDTools::UUID.random_create.to_s}"
             data = tsv_to_flot_data plot.value.text
          %>

          <li id="<%= div_id -%>" class="plot"></li>
          <script type="text/javascript">
              $(function () {
                  var json_data = <%= data -%>;

                  var options = { series: {
                      curvedLines: {
                          active: true
                      }
                  }
                  };

                  $.plot($("#<%= div_id -%>"), json_data, options);
              });
          </script>
      <% end -%>
      <li style="clear:both;">&nbsp;</li>
    </ul>
  </div>
</li>