<!-- JWS CONSTRUCTOR -->

<%= javascript_include_tag "jws/JWSconstructor_panels.js","jws/webMathematica.js","jws/addEvent.js","jws/sweetTitles.js","jws/Resizeable_Textbox/javascript.js","jws/Resizeable_Container/javascript.js","jws/jws_builder.js" -%>

<%= stylesheet_link_tag 'jws/JWSconstructor_panels','jws/Resizeable_Textbox/style.css','jws/Resizeable_Container/style.css','jws/sweetTitles.css','jws/jws_builder' -%>
<style>
    .builder_box {
        width: 50em;
        padding: 3px;
        float: left;
    }				
</style>
<ul class="sectionIcons">
    <li>
        <%= image_tag_for_key('back', model_path(@model,:version=>@display_model.version), nil, nil, "Back to model") -%>
    </li>
</ul>
<%= render :partial=>"models/builder/header" -%>
<div class="yui-gf">
    <div class="yui-u first builder_actions" style="width:19%;">
        <!-- Simulate action --><h6>Simulate</h6>
        <input type=checkbox name="steadystate" id="steadystate" />Steady State Analysis?
        <br/>
        <input value="Simulate" type="button" alt="Simulate" title="" id="simulate_button" onclick="create_panel_cookies();simulate_clicked();"/>
        <br/>
        <br/>
        <!-- Save new version action --><h6>Save as new version</h6>
        Model format: <%= select_tag "model_format","<option value='sbml'>SBML</option><option value='dat'>JWS Dat</option>" -%>
        <br/>
        <input value="Save" type="button" alt="Save" title="" id="new_version_button" onclick="create_panel_cookies();save_new_version_extra_options();"/>
        <br/>
        <br/>
        <!-- Validate --><h6>Validate</h6>
        <div>
            <input value="Check" type="button" alt="Check" title="Check the modified values are valid" id="check_button" onclick="create_panel_cookies();check_clicked();"/>
        </div>
        <br/>
    </div>
    <div class="yui-u" style="width: 80%; height: 100%; margin-left: 0.1em;">
		<button onclick="toggleContent()" title="Opens or closes all the input panels simultaneously">
            Open/Close all panels
        </button>
        <% recognised_errors = @error_keys.collect{|k| jws_key_to_text(k)}.compact -%>
        <% if recognised_errors.empty? -%>
			<div class="jws_success">
	            Model validated successfully.
	        </div>
		<% else -%>
	        <div class="jws_errors">
	            There were problems reported with: <%= join_with_and(recognised_errors) -%>
	        </div>
	        <script type="text/javascript">
	            $('simulate_button').disabled = true;
	            $('new_version_button').disabled = true;
	        </script>
        <% end -%>
        
        <% form_tag submit_to_jws_model_path(@model,:version=>@display_model.version),:name=>"form",:id=>"form" do -%>
        <input type="hidden" name="new_version_comments" id="new_version_comments" value=""/><input type="hidden" name="new_version_filename" id="new_version_filename" value=""/><input type="hidden" name="following_action" id="following_action" value=""/><input type="hidden" name="saved_model_format" id="saved_model_format" value=""/><input type="hidden" name="steadystateanalysis" id="steadystateanalysis"/>
        <br/>
        <br/>
        <div>
            <div id="name_top" class="builder_box">
                <div class="squarebox">
                    <div id="name_caption" class="squareboxgradientcaption" onclick="togglePanel('name');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Model name
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="name_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="name_panel" style="display: none">
                        <!-- model name script -->
                        <script type="text/javascript">
                            var rtmodelname = new ResizeableTextbox('modelname');	
                            rtmodelname.SetText("<%= @params_hash['modelname'] -%>");
                            rtmodelname.GetContainer().style.left = '10px';
                            rtmodelname.GetContainer().style.top = '10px';
                            rtmodelname.SetCurrentWidth(600);
							rtmodelname.SetMaxWidth(600);
							rtmodelname.SetCurrentHeight(100);
							rtmodelname.SetMaxHeight(800);
							
                        </script>
                        <p>
                            <button title="Examples for model names are: model1, westerhoff2010" onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpName.html','model name help window', 'width=300,height=300,toolbar=0'); return false;">
                                Model name help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="reactions_top" class="builder_box">
                <div class="squarebox">
                    <div id="reactions_caption" class="squareboxgradientcaption" onclick="togglePanel('reactions');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Reactions
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="reactions_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="reactions_panel" style="display: none">
                        <!-- reactions script -->
                        <script type="text/javascript">
                            var rtreaction = new ResizeableTextbox('reaction');
                            rtreaction.SetText("<%= @params_hash['reaction'] -%>");
                            rtreaction.GetContainer().style.left = '10px';
                            rtreaction.GetContainer().style.top = '10px';
                            rtreaction.SetCurrentWidth(600);
							rtreaction.SetCurrentHeight(300);
                            rtreaction.SetMaxWidth(600);
                            rtreaction.SetMaxHeight(800);
                        </script>
                        <p>
                            <button title="Examples of model reactions:<br> v[1] {1}$sink + {1.5}b = {1}c + {1}d <br> vGLK {1}glc + {1}ATP = {1}g6p + {1}ADP" onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpReactions.html','model reactions help window', 'width=400,height=600,toolbar=0'); return false;">
                                Reactions help
                            </button>
                            <input value="Show schema" type="button" onclick="create_panel_cookies();$('plotGraphPanel').value='on';this.form.submit();" alt="Evaluate" width="175" />&nbsp;<input value="Hide schema" type="button" onclick="create_panel_cookies();$('plotGraphPanel').value='off';this.form.submit();" alt="Evaluate" width="175" /><!-- resizable? script -->
                            <% if @objects_hash["reactionImage"] -%>
                            <%= hidden_field_tag "plotGraphPanel","on" -%>
                            <%= @objects_hash["reactionImage"] -%>
                            <script type="text/javascript">
                                var rc = new ResizeableContainer('resizeableElement');
                                rc.GetContainer().style.left = '10px';
                                rc.GetContainer().style.top = '10px';
                                rc.SetMaxWidth(600);
                                rc.SetMaxHeight(800);
                                rc.SetCurrentWidth2(600);
                                rc.SetCurrentHeight(300);
                            </script>
                            <% else -%>
                            <%= hidden_field_tag "plotGraphPanel","off" -%>
                            <% end -%>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="equations_top" class="builder_box">
                <div class="squarebox">
                    <div id="equations_caption" class="squareboxgradientcaption" onclick="togglePanel('equations');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Rate equations
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="equations_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="equations_panel" style="display: none">
                        <!-- equations script -->
                        <script type="text/javascript"> 
						var rtkinetics = new ResizeableTextbox('kinetics');
						rtkinetics.SetText("<%= @params_hash['kinetics'] -%>");
						rtkinetics.GetContainer().style.left = '10px';
						rtkinetics.GetContainer().style.top = '10px';
						rtkinetics.SetCurrentWidth(600);
						rtkinetics.SetCurrentHeight(300);
						rtkinetics.SetMaxWidth(600);
						rtkinetics.SetMaxHeight(800);
					</script>
                        <p>
                        </p>
                        <p>
                            <button title="Examples of rate equations:<br> v[1] = k1*sink*a[t]/(a[t]+Kma)-k2*c[t]*d[t]<br> vGLK = Vm*glc[t]/(KmGLKglc+glc[t])" onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpRateEquations.html','model rate equations help window', 'width=400,height=600,toolbar=0'); return false;">
                                Rate equations help
                            </button>
                            <input value="Show eqs graph" type="button" onclick="create_panel_cookies();$('plotKineticsPanel').value='on';this.form.submit();" alt="Evaluate" width="175" />&nbsp;<input value="Hide eqs graph" type="button" onclick="create_panel_cookies();$('plotKineticsPanel').value='off';this.form.submit();" alt="Evaluate" width="175" /><!-- resizable_2 script -->
                            <% if @objects_hash["kineticsImage"] -%>
                            <%= hidden_field_tag "plotKineticsPanel","on" -%>
                            <%= @objects_hash["kineticsImage"] -%>
                            <script type="text/javascript"> 
						        var rc2 = new ResizeableContainer('resizeableElement2');
						        rc2.GetContainer().style.left = '10px';
						        rc2.GetContainer().style.top = '10px';
								rc2.SetCurrentWidth2(600);
								rc2.SetCurrentHeight(300);
						        rc2.SetMaxWidth(600);
						        rc2.SetMaxHeight(800);
						      </script>
                            <% else -%>
                            <%= hidden_field_tag "plotKineticsPanel","off" -%>
                            <% end -%>
                        </p>
                    </div>
                </div><img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="initial_top" class="builder_box">
                <div class="squarebox">
                    <div id="initial_caption" class="squareboxgradientcaption" onclick="togglePanel('initial');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Initial values
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="initial_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div id="initial_panel" class="squareboxcontent" style="display: none">
                        <!-- initial values script -->
                        <script type="text/javascript"> 
							var rtinitVal = new ResizeableTextbox('initVal');
							rtinitVal.SetText("<%= @params_hash['initVal'] -%>");
							rtinitVal.GetContainer().style.left = '10px';
							rtinitVal.GetContainer().style.top = '10px';
							rtinitVal.SetCurrentWidth(600);
							rtinitVal.SetCurrentHeight(400);
							rtinitVal.SetMaxWidth(600);
							rtinitVal.SetMaxHeight(800);
							</script>
                        <p>
                            <button title="Example of variable initialisations:<br> x[0] = 1<br> g6p[0] = 1.4 " onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpInitVals.html','model parameter values help window', 'width=300,height=300,toolbar=0'); return false;">
                                Initial values help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="parameters_top" class="builder_box">
                <div class="squarebox">
                    <div id="parameters_caption" class="squareboxgradientcaption" onclick="togglePanel('parameters');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Parameter values
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="parameters_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div id="parameters_panel" class="squareboxcontent" style="display: none">
                        <!--parameters script -->
                        <script type="text/javascript"> 
							var rtparameterset = new ResizeableTextbox('parameterset');
							rtparameterset.SetText("<%= @params_hash['parameterset'] -%>");
							rtparameterset.GetContainer().style.left = '10px';
							rtparameterset.GetContainer().style.top = '10px';
							rtparameterset.SetCurrentWidth(600);
							rtparameterset.SetCurrentHeight(300);
							rtparameterset.SetMaxWidth(600);
							rtparameterset.SetMaxHeight(800);							
							</script>
                        <p>
                            <button title="Example of parameter initialisations:<br> k1 = 1<br> k2 = 3 " onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpParameters.html','model parameter values help window', 'width=300,height=300,toolbar=0'); return false;">
                                Parameters help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="assignments_top" class="builder_box">
                <div class="squarebox">
                    <div id="assignments_caption" class="squareboxgradientcaption" onclick="togglePanel('assignments');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Assignment rules
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="assignments_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="assignments_panel" style="display: none">
                        <!-- rules script -->
                        <script type="text/javascript"> 
										var rtassignmentRules = new ResizeableTextbox('assignmentRules');
										rtassignmentRules.SetText("<%= @params_hash['assignmentRules'] -%>");
										rtassignmentRules.GetContainer().style.left = '10px';
										rtassignmentRules.GetContainer().style.top = '10px';
										rtassignmentRules.SetCurrentWidth(600);
										rtassignmentRules.SetCurrentHeight(300);
										rtassignmentRules.SetMaxWidth(600);
										rtassignmentRules.SetMaxHeight(800);
										</script>
                        <p>
                            <button title="Examples of assignment rules are:<br>totalP := P1[t]+P2[t]<br> a := a[t]+Sin[t]  " onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpAssignmentRules.html','model assignments rules help window', 'width=300,height=300,toolbar=0'); return false;">
                                Assignment rules help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="functions_top" class="builder_box">
                <div class="squarebox">
                    <div id="functions_caption" class="squareboxgradientcaption" onclick="togglePanel('functions');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Functions
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="functions_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="functions_panel" style="display: none">
                        <!-- functions script -->
                        <script type="text/javascript"> 
										var rtfunctions = new ResizeableTextbox('functions');
										rtfunctions.SetText("<%= @params_hash['functions'] -%>");
										rtfunctions.GetContainer().style.left = '10px';
										rtfunctions.GetContainer().style.top = '10px';
										rtfunctions.SetCurrentWidth(600);
										rtfunctions.SetCurrentHeight(300);
										rtfunctions.SetMaxWidth(600);
										rtfunctions.SetMaxHeight(800);
										</script> 
                        <p>
                            <button title="Examples of functions are:<br> mmKin[vm_,s_,kms_] := vm*s/(s+kms)<br>aFree[tot_]:=tot-a[t]" onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpFunctions.html','model functions help window', 'width=300,height=500,toolbar=0'); return false;">
                                Functions help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
            <div id="events_top" class="builder_box">
                <div class="squarebox">
                    <div id="events_caption" class="squareboxgradientcaption" onclick="togglePanel('events');" style="height:20px; cursor: pointer;">
                        <div style="float: left">
                            Events
                        </div>
                        <div style="float: right; vertical-align: middle">
                            <img id="events_chevron" title="Show/Hide" src="/images/jws/expand.gif" border="0" height="14" alt="Show/Hide" width="13" />
                        </div>
                    </div>
                    <div class="squareboxcontent" id="events_panel" style="display: none">
                        <!-- events script -->
                        <script type="text/javascript"> 
							var rtevents = new ResizeableTextbox('events');
							rtevents.SetText("<%= @params_hash['events'] -%>");
							rtevents.GetContainer().style.left = '10px';
							rtevents.GetContainer().style.top = '10px';
							rtevents.SetCurrentWidth(600);
							rtevents.SetCurrentHeight(300);
							rtevents.SetMaxWidth(600);
							rtevents.SetMaxHeight(800);
							</script>
                        <p>
                            <button title="Examples of events are:<br> ?" onclick="window.open('http://jjj.mib.ac.uk/webMathematica//Examples/JWSconstructor_panels/text/helpEvents.html','model events help window', 'width=300,height=500,toolbar=0'); return false;">
                                Events help
                            </button>
                        </p>
                    </div>
                </div>
                <img src="/images/jws/shadow2.gif" height="10" alt="" width="100%" />
            </div>
        </div><% end -%>
    </div>
</div><!-- JWS CONSTRUCTOR END -->
<script type="text/javascript">
    map_rt_elements();
    read_panel_cookies();    
</script>

<%= render :partial=>"models/builder/new_version_details" -%>
<% @error_keys.collect{|err_key| jws_key_to_prefix(err_key)}.compact.each do |prefix| -%>
<script type="text/javascript">
    highlight_error("<%= prefix -%>");
</script>
<% end -%>