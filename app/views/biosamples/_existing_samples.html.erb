<script type="text/javascript" charset="utf-8">
    $j(document).ready(function() {
        sample_table = $j('#sample_table').dataTable({
            "bPaginate": false,
            "bLengthChange": false,
            "bFilter": false,
            "bSort": true,
            "bInfo": false,
            "bAutoWidth": false,
            "bRetrieve": true,
            "aaSorting": [
                [ 1, "asc" ]
            ],
            "aoColumns": [
                null,
                { "sWidth": "30%" },
                { "sWidth": "25%" },
                { "sWidth": "30%" },
                { "sWidth": "15%" }
            ],
            "fnInitComplete": function () {
                this.fnAdjustColumnSizing(true);
            }
        }).rowGrouping({"sGrupingClass": 'row_group_color'});

    });
</script>
<div id="existing_samples">
  <% unless specimens.blank? %>
      <h2>Sample</h2>
      <% if existing_samples.empty? -%>
          <p class="none_text">No samples have yet been defined for selected <%= CELL_CULTURE_OR_SPECIMEN -%>s
          </p>
      <% else -%>
          <br/>
          <br/>

          <div class="scroll_box">
            <table cellpadding="0" cellspacing="0" border="0" class="display" id="sample_table">
              <thead>
              <tr>
                <th>Specimen</th>
                <th>Lab internal identifier</th>
                <th>Sampling date</th>
                <th>Provider name</th>
                <th>ID</th>
              </tr>
              </thead>
              <tbody>
              <% existing_samples.each do |sample| -%>
                  <% if sample.sampling_date.nil? %>
                      <% sampling_date = '' %>
                  <% else %>
                      <% if sample.try(:sampling_date).hour == 0 and sample.try(:sampling_date).min == 0 and sample.try(:sampling_date).sec == 0 then %>
                          <% sampling_date = sample.try(:sampling_date).strftime('%d/%m/%Y') %>
                      <% else %>
                          <% sampling_date = sample.try(:sampling_date).strftime('%d/%m/%Y @ %H:%M:%S') %>
                      <% end %>

                  <% end %>
                  <%
                     provider_name = sample.provider_name
                     provider_name = provider_name.blank? ? sample.contributor.try(:person).try(:name) : provider_name
                  %>
                  <%
                     specimen = sample.specimen
                     specimen_info = CELL_CULTURE_OR_SPECIMEN.capitalize + ' ' + specimen.title
                  %>
                  <tr class="gradeX">
                    <td><%= specimen_info %> </td>
                    <td><%= sample.lab_internal_number %> </td>
                    <td><%= sampling_date %> </td>
                    <td><%= provider_name %></td>
                    <td><%= sample.id %></td>
                  </tr>
              <% end -%>
              </tbody>
            </table>
          </div>
      <% end -%>
  <% end -%>
</div>
