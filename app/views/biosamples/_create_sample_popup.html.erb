<%
  @specimen = specimen || Specimen.new()
  culture_growth_options=options_for_select(CultureGrowthType.find(:all,:order=>:title).collect{|cg| [cg.title,cg.id]}.insert(0,"Not specified"),@specimen.try(:culture_growth_type_id))
  current_user_authorized_to_manage = @specimen.new_record?|| @specimen.can_manage?
  current_user_authorized_to_edit = @specimen.new_record?|| @specimen.can_edit?
  if @specimen.new_record?
     existing_creators = [current_user.person]
  else
     existing_creators = @specimen.creators
  end
-%>
<% form_tag :controller => 'samples', :action=>"create_specimen_sample" do -%>
<div id="redbox_contents_div" class="redbox_contents" style="width:800px;">
	<div class="head">
		<%= link_to_close_redbox image_tag("close.gif"), :style => "float:right; margin-left:0.5em; vertical-align:middle;" -%>
		<span style="vertical-align:middle;">
			Create new sample
		</span>
	</div>

    <div class="body">
        <h2><%= CELL_CULTURE_OR_SPECIMEN.capitalize%></h2>
        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Title:</label>
          <%= text_field_tag "specimen[title]", @specimen.try(:lab_internal_number), :style => 'float:right;margin-right:30em', :disabled =>  current_user_authorized_to_edit ? false : true %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;">Culture starting date:</label>
          <%= calendar_date_select_tag "specimen[born]", @specimen.try(:born), :time => "mixed", :style => 'float:right;margin-right:30em', :disabled =>  current_user_authorized_to_edit ? false : true %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Culture type:</label>
          <%= select_tag "specimen[culture_growth_type_id]",culture_growth_options, :style => 'float:right;width:13.5em;margin-right:30em', :disabled =>  current_user_authorized_to_edit ? false : true-%>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Provider ID:</label>
          <%= text_field_tag "specimen[provider_id]", @specimen.try(:provider_id), :style => 'float:right;margin-right:30em', :disabled =>  current_user_authorized_to_edit ? false : true %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Provider name:</label>
          <%= text_field_tag "specimen[provider_name]", @specimen.try(:provider_name), :style => 'float:right;margin-right:30em', :disabled =>  current_user_authorized_to_edit ? false : true %>
        </p>

        <% if current_user_authorized_to_manage %>
            <%= render :partial=>"assets/asset_form_bottom", :locals=> {
                    :resource_type => "Specimen",
                    :attribution_enable => false,
                    :show_publications => false,
                    :sharing_enable => false,
                    :existing_creators=>existing_creators,
                    :other_creators=>'@specimen.other_creators',
            } -%>
          <% else
                 creator_names = existing_creators.collect(&:name).join(', ')
          %>
            <p style="margin-bottom: 1.5em">
              <label style="float: left;"> Creators:</label>
              <%= text_field_tag "specimen[creators]", creator_names, :style => 'float:right;margin-right:30em', :disabled => true %>
            </p>

            <p style="margin-bottom: 1.5em">
              <label style="float: left;"> Other creators:</label>
              <%= text_field_tag "specimen[other_creators]", @specimen.try(:other_creators), :style => 'float:right;margin-right:30em', :disabled => true %>
            </p>
        <% end %>

        <h2>Sample</h2>
        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Title:</label>
          <%= text_field_tag "sample[title]", nil, :style => 'float:right;margin-right:30em' %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Lab internal identifier:</label>
          <%= text_field_tag "sample[lab_internal_identifier]", nil, :style => 'float:right;margin-right:30em' %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;"> Provider:</label>
          <%= text_field_tag "sample[provider_name]", nil, :style => 'float:right;margin-right:30em' %>
        </p>

        <p style="margin-bottom: 1.5em">
          <label style="float: left;">Sampling date:</label>
          <%= calendar_date_select_tag "sample[born]", nil, :time => "mixed", :style => 'float:right;margin-right:30em' %>
        </p>

    </div>
      <div align="center" style="margin-bottom: 1em">
        <%= submit_tag('Create', :disable_with=> "Creating ...", :style => "font-weight: bold;")%> Or
        <input type=button value='Cancel' onclick="RedBox.close()">
      </div>
    </div>
    <%= hidden_field_tag 'specimen[id]', @specimen.try(:id) %>
    <%= hidden_field_tag 'sample[id]', sample.try(:id) %>
<% end %>
