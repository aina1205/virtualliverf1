<%= javascript_include_tag "studies.js" %>


<%= error_messages_for :study %>


<center>
  <div style="width: 60%;">

    <p style="margin-top: 1.5em;">
      <%= f.label "Title *" %><br/>
      <%= f.text_field :title,:style=>"width: 100%;" %>
    </p>

    <p style="margin-top: 0.5em;">
      <%= f.label :description %><br/>
      <%= f.text_area :description,:style => "width: 100%;", :rows => 5 %>
    </p>

    <p>
      <%= f.label "Experimentalist(s)" %>
      <%= f.text_field :experimentalists,:style=>"width: 100%;" %>
    </p>


  </div>
</center>

<br/>

<div class="fold">
  <div class="foldTitle">
    Project and Investigation
  </div>
  <div class="foldContent">

    <p>
      <%= f.label :project %><br/>
      <%
      selected_project=@study.project ? @study.project.id : 0
    %>
      <%=
      select_tag :project_id,
        options_for_select([["Select project ..",0]]|current_user.person.projects.collect{|p| [h(p.name),p.id]},selected_project),
        {:onchange=>remote_function(
          :url=>{:action=>"project_selected_ajax"},
          :with=>"'project_id='+this.value",
          :before=>"show_ajax_loader('investigation_collection')"
        ),:style=>"width:82%"

      }
    %>
    </p>

    <p>
      <%= f.label :investigation %><br/>
      <div id="investigation_collection">
        <% investigations = @study.project ? @study.project.investigations : [] -%>
        <%= render :partial=>"studies/investigation_list",:locals=>{:investigations=>investigations} -%>
      </div>
      <br/>
    </p>


  </div>
</div>

<%= render :partial=>"assays/assay_selection",:locals=>{:f=>f} %>



<script type="text/javascript">
  var CREATE_INVESTIGATION_LINK = "<%= create_investigation_url %>";
</script>


<p style="margin-top: 2em; text-align: center;">
  <%= f.submit(action==:edit ? "Update" : "Create") -%>
  or <%= link_to 'Cancel', (@study.id ? study_path(@study.id) : studies_path) -%>
</p>
