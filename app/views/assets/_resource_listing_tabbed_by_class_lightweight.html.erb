<%# this partial will display a dynamically generated view of all assets from a collection; -%>
<%# different types of assets will be placed in different tabs based on their class; -%>
<%# the partial requires 3 parameters to be defined: -%>
<%# - resource_hash: a hash of all resource instances, where keys are resource class names and values are arrays of resource instances of that class -%>
<%# - narrow_view: type of the partial to use for asset listings: 'false' to use the same partial with much info as on SOPs listing page -%>
<%#                                                               'true' to use a partial with fewer information; suitable for 'show' pages for people/projects -%>
<%# - authorization_already_done: boolean value indicating whether all items in the collection have already been authorized for the current user to view or not -%>
<% tabs_id ||= "resource_list_by_class" -%>
<% scale_title ||= tabs_id.gsub("_resource_listing_tabbed_by_class", "")%>
<% narrow_view ||= false -%>
<% actions_partial_disable ||= false %>

<script type="text/javascript">
  tabber_ids.push("<%= tabs_id -%>");
</script>

<% total_count = 0 %>
<% resource_hash.each_key do |k| %>
  <% count = resource_hash[k].count %>
  <% resource_hash.delete(k) if count == 0 %>
  <% total_count += count %>
<% end %>
<% unless total_count == 0-%>
  <div id='<%= "#{tabs_id}_spinner" -%>'>
    <center>
      <%= image_tag "ajax-loader-large.gif" -%>
    </center>
  </div>
  <div <%= "id='#{tabs_id}'" if tabs_id -%> class="tabber" style="display:none;">
    <%
       sorted_result_keys = resource_hash.keys.sort_by do |key|
          ASSET_ORDER.index(key)
       end
    %>

    <% sorted_result_keys.each do |key| -%>
        <div class="tabbertab">
          <% tab_title = "#{key} (#{resource_hash[key].count})" -%>
          <h3 class="<%= scale_title %>_<%= key %>"><%= tab_title -%></h3>
        </div>

    <% end %>

    <%# first_tab_resources = resource_hash[sorted_result_keys.first]%>
    <%#= render :partial => "assets/resource_list", :locals => { :collection => first_tab_resources,
                                                                :narrow_view => narrow_view,
                                                                :authorization_for_showing_already_done => true,
                                                                :actions_partial_disable => actions_partial_disable} -%>


  </div>
<% else -%>
  <span class="none_text">No items.</span>
<% end -%>

<div id="<%= scale_title %>_list_items_container"></div>

<script type="text/javascript">
    load_tabs();
    <% sorted_result_keys.each do |key| %>
        tabs_on_click('<%= key %>', '<%= resource_hash[key].collect(&:id).join(',') %>', '<%= scale_title %>');
    <% end %>

    document.getElementsByClassName('<%= scale_title %>' + '_' + '<%= sorted_result_keys.first %>')[0].click();

</script>




