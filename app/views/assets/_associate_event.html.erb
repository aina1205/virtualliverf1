<% project_events = Event.all.select(&:can_view?).sort_by(&:title).select {|e| e.project == resource.project} %>

<% fancy_multiselect resource, :events, :name => :event_ids do %>
    <br/>

    <%= check_box_tag :include_other_project_events, nil, false, {:onchange=>"swapSelectListContents('possible_event_ids','alternative_event_ids');",:style=>"margin-top:0.5em;"} -%> Include Events from other projects?
    <%= select_tag :alternative_event_ids, options_for_select([["Select events ...",0]]|project_events.collect{|o| [truncate(h(o.title), :length=>120), o.id]}), {:style => 'display:none;'} %>
<% end %>

<script type="text/javascript">
    <%# because the list generated by fancy_multiselect will have all events,
    and the checkbox defaults to 'false', I need to swap them to start %>
    swapSelectListContents('possible_event_ids','alternative_event_ids');
</script>
