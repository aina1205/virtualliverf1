<%= javascript_include_tag 'calendar_date_select/calendar_date_select' %>
<%= stylesheet_link_tag 'calendar_date_select/default' %>
<%= stylesheet_link_tag "settings" -%>

<%
  select_truncate_length=120
  all_organisms = Organism.find(:all,:order=>:title)
  culture_growth_options=options_for_select(CultureGrowthType.find(:all,:order=>:title).collect{|cg| [cg.title,cg.id]}.insert(0,"Not specified"),@specimen.culture_growth_type_id)
-%>
<div class="fold">

  <div class="foldTitle">
    <%= help_icon("Here you can associate the specimen with specific organism and strain.") -%>
    Organism <span class="required">*</span>
  </div>

  <div id="organisms_fold_content" class="foldContent" style="display: block;">
    <div class="yui-u first">

      <div class="association_step">
        <b>Step 1</b> - Choose an organism<br/><br/>
        <%= select_tag "specimen[organism_id]",
        options_for_select([["Select Organism ...", 0]]|all_organisms.collect{|o| [truncate(h(o.title), :length=>select_truncate_length), o.id]},@specimen.organism_id),
         {:style=>"width:90%",
          } -%>


      </div>
      <div id="extra_organism_details" style="display:none;">
        <div class="association_step">
          <b>Step 2</b> - Select method of culture growth (optional)<br/><br/>
          <%= select_tag "specimen[culture_growth_type_id]",culture_growth_options ,{:onchange=>"check_show_which_fields();return(false);"}-%>
          <br/>
         <div id="fields_for_cultured_cell_line_and_primary_cell_culture" style="display:none;">
           <table id="table1" border="1" cellpadding="10" >
               <tr>
                <td> <%= f.label :medium -%></td>
                <td> <%= f.text_field :medium  %></td>
               </tr>
               <tr>
                 <td><%= f.label :culture_format -%></td>
                <td> <%= f.text_field :culture_format  %></td>
               </tr>
               <tr>
                 <td><%= f.label :temperature -%></td>
                 <td><%= f.text_field :temperature  %> </td>
               </tr>
               <tr>
                 <td><%= f.label :ph,"pH" -%></td>
                 <td><%= f.text_field :ph  %></td>
               </tr>
               <tr>
                 <td><%= f.label :confluency -%></td>
                 <td><%= f.text_field :confluency  %> </td>
               </tr>
               <tr>
                 <td><%= f.label :passage -%></td>
                 <td><%= f.text_field :passage  %> </td>
               </tr>
               <tr>
                 <td><%= f.label :viability -%></td>
                 <td><%= f.text_field :viability  %> </td>
               </tr>
               <tr>
                 <td><%= f.label :purity -%></td>
                 <td><%= f.text_field :purity  %> </td>
               </tr>
         </table>
         </div>

         <div id="fields_for_vivo" style="display:none;">
           <br/>
           <table id="table2" border="1" >
           <tr>
             <td style="text-align:left;"><%= f.label :sex -%></td>
             <td style="text-align:left;"><%= f.select :sex,options_for_select({"female"=>true,"male"=>false},@specimen.sex),:include_blank=>"Not Specified"%> </td>
           </tr>

           <tr>
             <td style="text-align:left;"><%= f.label :age -%></td>
             <td style="text-align:left;"><%= f.text_field :age, :style => "width: 150px;" -%> weeks </td>
           </tr>

           <tr>
             <td style="text-align:left;"><%= f.label "Birthday" -%></td>
            <td style="text-align:left;"> <%= f.calendar_date_select :born, :time => "mixed" -%></td>
           </tr>
          </table>
         </div>

          <br/>

        </div>
        <div class="association_step">
          <b>Step 3</b> - Create a strain (optional)<br/>
          <%= render :partial=>'admin/setting_li',:locals=>{
            :name=>"Create based on existing strain",
            :field=>check_box_tag(:create_from_existing_strain, 1, false,
            :onchange=>remote_function(:url=>{:action=>"show_existing_strains", :controller=>"strains",:element=>"existing_strains"},
                :with=>"'organism_id='+ $F('specimen_organism_id')",
                :before=>"show_ajax_loader('existing_strains')")+
                ";check_show_add_organism();return(false);")
          } -%>
          <div id="existing_strains"></div>
          <div id="existing_strain"></div>
          <%= render :partial=>'admin/setting_li',:locals=>{
            :name=>"Create a new strain",
            :field=>check_box_tag(:create_new_strain, 1)
          } -%>
          <br/>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
 var organism = new Array();
  function setStrainTextField(strain){
      $('specimen_strain_title').value = strain;
      new Effect.Highlight('specimen_strain_title');
  }


    function check_show_add_organism() {

      selected_id = $F('specimen_organism_id') ;
      if (selected_id == '0') {
        Effect.Fade('extra_organism_details');
      }
      else {
        Effect.Appear('extra_organism_details');
      }
    }


    function check_show_which_fields(){
        if($F('specimen_culture_growth_type_id')){
        selected_option_index=$("specimen_culture_growth_type_id").selectedIndex;
        selected_option=$("specimen_culture_growth_type_id").options[selected_option_index];
        title=selected_option.text;

        var div1 = document.getElementById('fields_for_cultured_cell_line_and_primary_cell_culture');
        var div2 = document.getElementById('fields_for_vivo');

        if (title=="cultured cell line" || title=="primary cell culture"){
            div1.style.display = 'block';
            div2.style.display='none';


        }
        else if(title=="in vivo"){
            div2.style.display = 'block';
            div1.style.display='none';




        }else{
           div1.style.display = 'none';
           div2.style.display='none';

        }
       }
    }

    check_show_add_organism();
    check_show_which_fields();

</script>
