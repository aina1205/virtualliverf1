<%= javascript_include_tag 'calendar_date_select/calendar_date_select' %>
<%= javascript_include_tag 'strain.js'%>
<%= stylesheet_link_tag 'calendar_date_select/default' %>

<%
  select_truncate_length=120
  all_organisms = Organism.find(:all,:order=>:title)
  culture_growth_options=options_for_select(CultureGrowthType.find(:all,:order=>:title).collect{|cg| [cg.title,cg.id]}.insert(0,"Not specified"))
-%>

        <h4 style="margin-left: 7em;margin-top:1em;margin-bottom:1em;font-style:italic;color:gray;">Here you can navigate Organism-Strain-Sample. You also can create new strain or new sample</h4>
          <ul class="sectionIcons">
            <li><%= create_strain_popup_link-%></li>
            <li><%= create_sample_popup_link-%></li>
          </ul>
        <br/>
        <h2>Organism</h2>
        <%= select_tag "strain[organism_id]",
        options_for_select([["Select Organism ...", 0]]|all_organisms.collect{|o| [truncate(h(o.title), :length=>select_truncate_length), o.id]},:selected => try_block{current_user.person.projects.first.organism_ids.first}),
         {:onchange=>remote_function(:url=>{:action=>"existing_strains", :controller=>"strains"},
          :with=>"'organism_id='+this.value",
          :before=>"show_ajax_loader('existing_strains')")+ ";check_show_existing_strains('strain_organism_id', 'existing_strains', ''); return(false);" } -%>
        <br/>
        <div id="existing_strains"></div>
        <div id="existing_specimens"></div>
        <div id="existing_samples"></div>



<script type="text/javascript">

 var organism = new Array();

    function check_show_which_fields(){
        if($F('specimen_culture_growth_type_id')){
        selected_option_index=$("specimen_culture_growth_type_id").selectedIndex;
        selected_option=$("specimen_culture_growth_type_id").options[selected_option_index];
        title=selected_option.text;

        var div1 = document.getElementById('fields_for_cultured_cell_line_and_primary_cell_culture');
        var div2 = document.getElementById('fields_for_vivo');
        var div3 = document.getElementById('fields_for_batch_and_chemostat');

        if (title=="cultured cell line" || title=="primary cell culture"){
            div1.style.display = 'block';
            div2.style.display='none';
            div3.style.display='none';
        }
        else if(title=="in vivo"){
            div2.style.display = 'block';
            div1.style.display='none';
            div3.style.display='none';

        }else if (title=="batch" || title=="chemostat"){
           div1.style.display = 'none';
           div2.style.display='none';
           div3.style.display='block';
        }
        else{
           div1.style.display = 'none';
           div2.style.display='none';
           div3.style.display='none';
        }
       }
    }
    check_show_existing_strains('strain_organism_id', 'existing_strains', '<%=url_for(:controller => 'strains', :action => 'existing_strains')-%>');
    check_show_which_fields();
</script>
