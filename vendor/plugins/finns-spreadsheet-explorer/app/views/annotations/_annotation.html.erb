<div class="annotation" id="annotation_<%=annotation.id-%>">
  <% form_remote_tag(:url=>{:controller=>"spreadsheet_annotations", :action=>"update", :id => annotation.id}, 
                 :method => :put,  
                 :update => { :success => "hidden_annotations", :failure => "hidden_annotations"},
                 :loading => "Element.show('spinner');",
                 :complete => "Element.hide('spinner');", :html => {:id => "annotation_form"}) do %>
      
  <div class="annotation_header">
    <%= avatar(annotation.source.person, 24) -%>
    <div style="float: left">
      <%= link_to(annotation.source.person.name, annotation.source.person)%><br/> 
      <%= time_ago_in_words(annotation.created_at) %> ago
    </div>
    <br style="clear:both"/>
  </div>
  <div class="annotation_content">
    <%= text_area_tag :annotation_content, annotation.content, :readonly => true %>
  </div>  
  <div class="annotation_footer">
    <% if annotation.source == current_user %>
      <%= link_to_remote(image('destroy'), :url=>{:controller=>"spreadsheet_annotations", :action=>"destroy", :id => annotation.id},
                 :method => :delete,   
                 :update => { :success => "hidden_annotations", :failure => "hidden_annotations"},
                 :loading => "Element.show('spinner');",
                 :complete => "Element.hide('spinner');") -%>
      <%= link_to(image('edit'), '#', :onclick => "toggle_annotation_form('" + annotation.id.to_s + "'); return false;") -%>     
      <%= image_tag "ajax-loader.gif", :id => 'spinner', :style => 'display:none;' -%> 
    <% end -%>

    <span style="vertical-align: middle"><%= annotation.cell_coverage -%></span>
    <div id="annotation_controls" style="display:none">
      <%= submit_tag 'Save Changes',:id=>"fetch_button" %> or <%= link_to "Cancel", "", :onclick => "toggle_annotation_form('" + annotation.id.to_s + "'); return false;"-%>
    </div>
  </div>
  <% end %>
</div>
