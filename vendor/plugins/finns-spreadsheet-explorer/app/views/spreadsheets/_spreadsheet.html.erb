<% workbook.sheets.each_with_index do |sheet, sheet_index| -%>
  <a index="<%= sheet_index -%>" class="sheet_tab <%= "selected_tab" if workbook.sheets.first == sheet -%>" href="#"><%= sheet.name -%></a>
<% end %>

<div class="spreadsheet_container" onselectstart="return false;">
  
<!--- Sheets --->
<% workbook.sheets.each do |sheet| -%>
  <div style="display:none" class="sheet" id="<%= ("spreadsheet_" + sheet.name.sub(" ", "_").to_s) -%>">
    <table class="sheet" cellspacing="1">
      
      <!--- Column headings --->
      <tr>
        <th class="col_heading" style="width:3em"></th>
        <% sheet.columns.each do |col| -%>
        <th style="<%= (("width:" + (col.width.to_f/31).to_i.to_s) + "px") unless col.width.nil? -%>" class="col_heading"><%= to_alpha(col.index) -%></th>
        <% end -%>
      </tr>      
      
      <!--- Rows --->
      <% 1.upto(sheet.last_row) do |r| -%>
        <tr <%= (sheet[r].nil? || sheet[r].height.nil?) ? "" : "style =\"height:"+sheet[r].height+"\"" -%>>
          <!--- Row heading --->
          <td class="row_heading"><%= r -%></td>          
          <!--- Cells --->
          <% 1.upto(sheet.last_col) do |c| %>
            <% if sheet[r] && sheet[r][c] -%>
              <% cell = sheet[r][c] -%>
              <td row="<%= r -%>" col="<%= c -%>" id="cell_<%= to_alpha(c) + r.to_s -%>" title="<%= cell.formula || "" -%>" class="cell <%= cell.style || ""-%>"><%= cell.value -%></td>
            <% else -%>
              <td row="<%= r -%>" col="<%= c -%>" id="cell_<%= to_alpha(c) + r.to_s -%>" class="cell"></td>
            <% end -%>  
          <% end -%>          
        </tr>
      <% end -%>
      
    </table>
  </div>
<% end -%>

</div>

<script type = "text/javascript">
  //"activate" the first worksheet
  var activeSheet = $j("div.sheet").first();
  activeSheet.show().addClass('active_sheet');
  activeSheet.children("table").addClass('active_sheet');
</script>
      
